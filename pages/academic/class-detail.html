<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">KTS2024 - Đồ án 1 | HauHub</title>
    
    <!-- CSS Files (Giữ nguyên) -->
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../../css/pages/class-detail.css">
    
    <!-- Google Fonts & Icons (Giữ nguyên) -->
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (Giữ nguyên) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#136dec",
                        "background-light": "#FCFAF7",
                        "background-dark": "#101822",
                        "studio-blue": "#0d1b3e",
                    },
                    fontFamily: {
                        "display": ["Newsreader", "serif"],
                        "sans": ["Noto Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body { 
            font-family: 'Newsreader', serif;
            background-image: 
                linear-gradient(to right, rgba(19, 109, 236, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(19, 109, 236, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }
    </style>
    
    <!-- Favicon (Thêm như trang home) -->
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon.ico">
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen text-slate-800">
    <!-- Header sẽ được inject bởi JS (Thay thế header cũ) -->
    <header></header>
    
    <!-- Main Content (Giữ nguyên) -->
    <main class="main-content">
        <div id="page-content">
            <div class="container mx-auto px-4 md:px-10 lg:px-40 py-8 max-w-[1200px]">
                <!-- Breadcrumbs (Giữ nguyên) -->
                <nav class="breadcrumb-nav mb-6">
                    <!-- Breadcrumbs will be generated by JS -->
                </nav>
                
                <!-- Class Header (Giữ nguyên) -->
                <section class="class-header mb-8">
                    <div class="class-hero-card">
                        <div class="hero-content">
                            <div class="class-info">
                                <div class="class-icon">
                                    <span class="material-symbols-outlined">home_work</span>
                                </div>
                                <div class="class-details">
                                    <h1 class="class-name" id="class-name">KTS2024 - Đồ án 1</h1>
                                    <p class="instructor-info">
                                        <span class="material-symbols-outlined">person</span>
                                        GV: <span id="instructor-name">ThS. KTS Nguyễn Văn A</span>
                                    </p>
                                    <div class="class-meta">
                                        <span class="meta-item">
                                            <span class="material-symbols-outlined">calendar_today</span>
                                            <span id="class-schedule">Thứ 3 | 07:30 - 11:30</span>
                                        </span>
                                        <span class="meta-item">
                                            <span class="material-symbols-outlined">location_on</span>
                                            <span id="class-room">Phòng 402-H1</span>
                                        </span>
                                        <span class="meta-item">
                                            <span class="material-symbols-outlined">school</span>
                                            <span id="class-semester">HK1 - 2023-2024</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <button id="class-info-btn" class="btn-class-info">
                                Thông tin lớp học
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Main Content Area (Giữ nguyên) -->
                <div class="class-layout">
                    <!-- Left Column: Main Content (Giữ nguyên) -->
                    <div class="class-main">
                        <!-- Tabs Navigation (Giữ nguyên) -->
                        <div class="class-tabs">
                            <nav class="tabs-nav" id="tabs-nav">
                                <!-- Tabs will be generated by JS -->
                            </nav>
                        </div>
                        
                        <!-- Tab Content Container (Giữ nguyên) -->
                        <div class="tab-content-container">
                            <!-- Documents Tab (Giữ nguyên) -->
                            <div id="tab-documents" class="tab-content active">
                                <div class="tab-header">
                                    <h3 class="tab-title">Thư mục tài liệu</h3>
                                    <button id="download-all-btn" class="btn-download-all">
                                        <span class="material-symbols-outlined">download_for_offline</span>
                                        Tải xuống tất cả
                                    </button>
                                </div>
                                
                                <div id="documents-list" class="documents-list">
                                    <!-- Documents will be loaded by JS -->
                                </div>
                                
                                <!-- Upload Area (Giữ nguyên) -->
                                <div id="upload-area" class="upload-area" style="display: none;">
                                    <div class="upload-placeholder">
                                        <div class="upload-icon">
                                            <span class="material-symbols-outlined">grid_guides</span>
                                        </div>
                                        <p class="upload-text">Kéo thả tệp vào đây để tải lên</p>
                                        <p class="upload-note">(Dành cho giảng viên)</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Announcements Tab (Giữ nguyên) -->
                            <div id="tab-announcements" class="tab-content">
                                <!-- Announcements will be loaded by JS -->
                            </div>
                            
                            <!-- Students Tab (Giữ nguyên) -->
                            <div id="tab-students" class="tab-content">
                                <!-- Students list will be loaded by JS -->
                            </div>
                            
                            <!-- Discussions Tab (Giữ nguyên) -->
                            <div id="tab-discussions" class="tab-content">
                                <!-- Discussions will be loaded by JS -->
                            </div>
                            
                            <!-- Grades Tab (Giữ nguyên) -->
                            <div id="tab-grades" class="tab-content">
                                <!-- Grades will be loaded by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Sidebar (Giữ nguyên) -->
                    <div class="class-sidebar">
                        <!-- Quick Actions Card (Giữ nguyên) -->
                        <div class="sidebar-card">
                            <h3 class="sidebar-title">Tác vụ nhanh</h3>
                            <div class="action-buttons">
                                <button id="submit-assignment-btn" class="btn-action primary">
                                    <span class="material-symbols-outlined">cloud_upload</span>
                                    Nộp bài trực tuyến
                                </button>
                                <button id="contact-instructor-btn" class="btn-action secondary">
                                    <span class="material-symbols-outlined">mail</span>
                                    Liên hệ giảng viên
                                </button>
                                <button id="view-syllabus-btn" class="btn-action outline">
                                    <span class="material-symbols-outlined">description</span>
                                    Xem đề cương môn học
                                </button>
                            </div>
                        </div>
                        
                        <!-- Deadlines Widget (Giữ nguyên) -->
                        <div class="sidebar-card deadlines-card">
                            <div class="deadline-header">
                                <h3 class="sidebar-title">Hạn nộp sắp tới</h3>
                                <span class="deadline-indicator">
                                    <span class="ping-dot"></span>
                                    <span class="status-dot"></span>
                                </span>
                            </div>
                            <div id="deadlines-list" class="deadlines-list">
                                <!-- Deadlines will be loaded by JS -->
                            </div>
                        </div>
                        
                        <!-- Class Notes Card (Giữ nguyên) -->
                        <div class="sidebar-card notes-card">
                            <div class="notes-header">
                                <span class="material-symbols-outlined">info</span>
                                <h3 class="sidebar-title">Lưu ý lớp học</h3>
                            </div>
                            <div id="class-notes" class="notes-content">
                                <!-- Notes will be loaded by JS -->
                            </div>
                        </div>
                        
                        <!-- Class Stats Card (Giữ nguyên) -->
                        <div class="sidebar-card stats-card">
                            <h3 class="sidebar-title">Thống kê lớp</h3>
                            <div id="class-stats" class="stats-grid">
                                <!-- Stats will be loaded by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer sẽ được inject bởi JS (Thay thế footer cũ) -->
    <footer></footer>
    
    <!-- THÊM: AI Chat Widget Container (như trang home) -->
    <div id="ai-chat-widget"></div>
    
    <!-- Class Info Modal (Giữ nguyên) -->
    <div id="class-info-modal" class="modal" style="display: none;">
        <div class="modal-content large-modal">
            <h3 class="modal-title" id="modal-class-name">Thông tin lớp học</h3>
            <div class="modal-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Mã lớp:</label>
                        <span id="info-class-code">KTS2024</span>
                    </div>
                    <div class="info-item">
                        <label>Môn học:</label>
                        <span id="info-subject">Đồ án Kiến trúc 1</span>
                    </div>
                    <div class="info-item">
                        <label>Số tín chỉ:</label>
                        <span id="info-credits">3 tín chỉ</span>
                    </div>
                    <div class="info-item">
                        <label>Thời lượng:</label>
                        <span id="info-duration">60 tiết</span>
                    </div>
                    <div class="info-item">
                        <label>Giảng viên:</label>
                        <span id="info-instructor">ThS. KTS Nguyễn Văn A</span>
                    </div>
                    <div class="info-item">
                        <label>Email:</label>
                        <span id="info-instructor-email">nguyenvana@hau.edu.vn</span>
                    </div>
                    <div class="info-item">
                        <label>Phòng học:</label>
                        <span id="info-room">402-H1</span>
                    </div>
                    <div class="info-item">
                        <label>Thời gian học:</label>
                        <span id="info-schedule">Thứ 3, 07:30-11:30</span>
                    </div>
                    <div class="info-item full-width">
                        <label>Mô tả môn học:</label>
                        <p id="info-description" class="description-text">
                            Môn học giới thiệu các nguyên lý cơ bản trong thiết kế kiến trúc, 
                            tập trung vào không gian sống và công năng sử dụng.
                        </p>
                    </div>
                    <div class="info-item full-width">
                        <label>Mục tiêu học tập:</label>
                        <ul id="info-objectives" class="objectives-list">
                            <!-- Objectives will be loaded by JS -->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel">Đóng</button>
            </div>
        </div>
    </div>
    
    <!-- Upload Assignment Modal (Giữ nguyên) -->
    <div id="upload-assignment-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title">Nộp bài tập</h3>
            <form id="upload-assignment-form">
                <div class="form-group">
                    <label for="assignment-title">Tiêu đề bài nộp</label>
                    <input type="text" id="assignment-title" placeholder="VD: Bài tập tuần 1 - Phương án sơ phác" required>
                </div>
                <div class="form-group">
                    <label for="assignment-files">Tệp đính kèm</label>
                    <div class="file-upload-area">
                        <input type="file" id="assignment-files" multiple hidden>
                        <label for="assignment-files" class="file-upload-label">
                            <span class="material-symbols-outlined">upload</span>
                            <span>Chọn tệp hoặc kéo thả vào đây</span>
                            <span class="file-types">(PDF, DOC, DWG, JPG, PNG)</span>
                        </label>
                        <div id="file-list" class="file-list"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="assignment-note">Ghi chú (tùy chọn)</label>
                    <textarea id="assignment-note" rows="3" placeholder="Nhập ghi chú cho giảng viên..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel">Hủy</button>
                    <button type="submit" class="btn-submit">Nộp bài</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Contact Instructor Modal (Giữ nguyên) -->
    <div id="contact-instructor-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title">Liên hệ giảng viên</h3>
            <form id="contact-instructor-form">
                <div class="form-group">
                    <label for="contact-subject">Tiêu đề</label>
                    <input type="text" id="contact-subject" placeholder="VD: Thắc mắc về đề bài đồ án" required>
                </div>
                <div class="form-group">
                    <label for="contact-message">Nội dung</label>
                    <textarea id="contact-message" rows="6" placeholder="Nhập nội dung cần trao đổi với giảng viên..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="contact-attachments">Tệp đính kèm (tùy chọn)</label>
                    <input type="file" id="contact-attachments" multiple>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel">Hủy</button>
                    <button type="submit" class="btn-submit">Gửi tin nhắn</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- JavaScript (Kết hợp cũ và mới) -->
    <script type="module">
        // Import các component mới (như trang home)
        import { Header } from '../../js/components/header.js';
        import { Footer } from '../../js/components/footer.js';
        import { AIChatWidget } from '../../js/components/chat-widget.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            // Inject Header, Footer, Chat Widget (như trang home)
            new Header();
            new Footer();
            new AIChatWidget();
            
            // Khởi tạo JS cũ của class detail (giữ nguyên chức năng)
            initializeClassDetail();
        });
        
        // Giữ nguyên hàm initializeClassDetail cũ (hoặc giữ script cũ)
        function initializeClassDetail() {
            // Modals
            const classInfoModal = document.getElementById('class-info-modal');
            const uploadAssignmentModal = document.getElementById('upload-assignment-modal');
            const contactInstructorModal = document.getElementById('contact-instructor-modal');
            
            // Class info button
            const classInfoBtn = document.getElementById('class-info-btn');
            if (classInfoBtn && classInfoModal) {
                classInfoBtn.addEventListener('click', () => {
                    classInfoModal.style.display = 'block';
                });
            }
            
            // Close class info modal
            const closeClassInfoBtn = classInfoModal?.querySelector('.btn-cancel');
            if (closeClassInfoBtn) {
                closeClassInfoBtn.addEventListener('click', () => {
                    classInfoModal.style.display = 'none';
                });
            }
            
            // Submit assignment button
            const submitAssignmentBtn = document.getElementById('submit-assignment-btn');
            if (submitAssignmentBtn && uploadAssignmentModal) {
                submitAssignmentBtn.addEventListener('click', () => {
                    uploadAssignmentModal.style.display = 'block';
                });
            }
            
            // Close upload assignment modal
            const closeUploadBtn = uploadAssignmentModal?.querySelector('.btn-cancel');
            if (closeUploadBtn) {
                closeUploadBtn.addEventListener('click', () => {
                    uploadAssignmentModal.style.display = 'none';
                });
            }
            
            // Contact instructor button
            const contactInstructorBtn = document.getElementById('contact-instructor-btn');
            if (contactInstructorBtn && contactInstructorModal) {
                contactInstructorBtn.addEventListener('click', () => {
                    contactInstructorModal.style.display = 'block';
                });
            }
            
            // Close contact modal
            const closeContactBtn = contactInstructorModal?.querySelector('.btn-cancel');
            if (closeContactBtn) {
                closeContactBtn.addEventListener('click', () => {
                    contactInstructorModal.style.display = 'none';
                });
            }
            
            // View syllabus button
            const viewSyllabusBtn = document.getElementById('view-syllabus-btn');
            if (viewSyllabusBtn) {
                viewSyllabusBtn.addEventListener('click', () => {
                    alert('Mở đề cương môn học');
                });
            }
            
            // Download all button
            const downloadAllBtn = document.getElementById('download-all-btn');
            if (downloadAllBtn) {
                downloadAllBtn.addEventListener('click', () => {
                    alert('Tải xuống tất cả tài liệu');
                });
            }
            
            // Form submissions
            const uploadForm = document.getElementById('upload-assignment-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const title = document.getElementById('assignment-title').value;
                    if (title) {
                        alert(`Đã nộp bài: ${title}`);
                        uploadAssignmentModal.style.display = 'none';
                        uploadForm.reset();
                    }
                });
            }
            
            const contactForm = document.getElementById('contact-instructor-form');
            if (contactForm) {
                contactForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const subject = document.getElementById('contact-subject').value;
                    if (subject) {
                        alert(`Đã gửi tin nhắn: ${subject}`);
                        contactInstructorModal.style.display = 'none';
                        contactForm.reset();
                    }
                });
            }
            
            // Tabs functionality
            const tabsNav = document.getElementById('tabs-nav');
            if (tabsNav) {
                const tabs = [
                    { id: 'documents', label: 'Tài liệu', icon: 'description' },
                    { id: 'announcements', label: 'Thông báo', icon: 'campaign' },
                    { id: 'students', label: 'Thành viên', icon: 'groups' },
                    { id: 'discussions', label: 'Thảo luận', icon: 'forum' },
                    { id: 'grades', label: 'Điểm số', icon: 'grade' }
                ];
                
                tabs.forEach(tab => {
                    const tabBtn = document.createElement('button');
                    tabBtn.className = 'tab-btn';
                    if (tab.id === 'documents') tabBtn.classList.add('active');
                    tabBtn.dataset.tab = tab.id;
                    tabBtn.innerHTML = `
                        <span class="material-symbols-outlined">${tab.icon}</span>
                        <span>${tab.label}</span>
                    `;
                    
                    tabBtn.addEventListener('click', function() {
                        // Remove active class from all tabs
                        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                        
                        // Add active class to clicked tab
                        this.classList.add('active');
                        document.getElementById(`tab-${this.dataset.tab}`)?.classList.add('active');
                    });
                    
                    tabsNav.appendChild(tabBtn);
                });
            }
            
            // Demo documents
            const documentsList = document.getElementById('documents-list');
            if (documentsList) {
                const documents = [
                    { name: 'Đề cương môn học.pdf', type: 'pdf', size: '2.4 MB', date: '01/09/2024', author: 'GV' },
                    { name: 'Bài giảng tuần 1.pptx', type: 'ppt', size: '5.8 MB', date: '05/09/2024', author: 'GV' },
                    { name: 'Tài liệu tham khảo.docx', type: 'doc', size: '3.1 MB', date: '10/09/2024', author: 'GV' },
                    { name: 'Hướng dẫn nộp bài tập.pdf', type: 'pdf', size: '1.2 MB', date: '12/09/2024', author: 'GV' }
                ];
                
                documents.forEach(doc => {
                    const docItem = document.createElement('div');
                    docItem.className = 'document-item';
                    docItem.innerHTML = `
                        <div class="document-icon ${doc.type}">
                            <span class="material-symbols-outlined">
                                ${doc.type === 'pdf' ? 'picture_as_pdf' : 
                                  doc.type === 'ppt' ? 'slideshow' : 
                                  doc.type === 'doc' ? 'description' : 'insert_drive_file'}
                            </span>
                        </div>
                        <div class="document-info">
                            <h4 class="document-name">${doc.name}</h4>
                            <div class="document-meta">
                                <span>${doc.size}</span>
                                <span>•</span>
                                <span>${doc.date}</span>
                                <span>•</span>
                                <span>${doc.author}</span>
                            </div>
                        </div>
                        <button class="document-action download">
                            <span class="material-symbols-outlined">download</span>
                        </button>
                    `;
                    
                    // Download button
                    const downloadBtn = docItem.querySelector('.download');
                    downloadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        alert(`Tải xuống: ${doc.name}`);
                    });
                    
                    documentsList.appendChild(docItem);
                });
            }
            
            // Demo deadlines
            const deadlinesList = document.getElementById('deadlines-list');
            if (deadlinesList) {
                const deadlines = [
                    { name: 'Bài tập tuần 1', date: '15/09/2024', status: 'warning' },
                    { name: 'Đồ án giữa kỳ', date: '30/09/2024', status: 'normal' },
                    { name: 'Bài tập tuần 2', date: '10/10/2024', status: 'normal' }
                ];
                
                deadlines.forEach(deadline => {
                    const deadlineItem = document.createElement('div');
                    deadlineItem.className = 'deadline-item';
                    deadlineItem.innerHTML = `
                        <div class="deadline-content">
                            <h4>${deadline.name}</h4>
                            <p>${deadline.date}</p>
                        </div>
                        <span class="deadline-status ${deadline.status}"></span>
                    `;
                    
                    deadlineItem.addEventListener('click', () => {
                        alert(`Xem chi tiết: ${deadline.name}`);
                    });
                    
                    deadlinesList.appendChild(deadlineItem);
                });
            }
            
            // Demo class notes
            const classNotes = document.getElementById('class-notes');
            if (classNotes) {
                classNotes.innerHTML = `
                    <p>• Lớp học bắt đầu đúng giờ, vui lòng có mặt trước 5 phút.</p>
                    <p>• Tài liệu sẽ được cập nhật trước mỗi buổi học.</p>
                    <p>• Nộp bài tập qua hệ thống trước 23:59 ngày hạn nộp.</p>
                    <p>• Liên hệ giảng viên qua email trong giờ hành chính.</p>
                `;
            }
            
            // Demo class stats
            const classStats = document.getElementById('class-stats');
            if (classStats) {
                const stats = [
                    { label: 'Sĩ số', value: '45/50' },
                    { label: 'Bài đã nộp', value: '38' },
                    { label: 'Điểm TB', value: '7.8' },
                    { label: 'Hoàn thành', value: '85%' }
                ];
                
                stats.forEach(stat => {
                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    statItem.innerHTML = `
                        <p class="stat-value">${stat.value}</p>
                        <p class="stat-label">${stat.label}</p>
                    `;
                    classStats.appendChild(statItem);
                });
            }
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (classInfoModal && e.target === classInfoModal) {
                    classInfoModal.style.display = 'none';
                }
                if (uploadAssignmentModal && e.target === uploadAssignmentModal) {
                    uploadAssignmentModal.style.display = 'none';
                }
                if (contactInstructorModal && e.target === contactInstructorModal) {
                    contactInstructorModal.style.display = 'none';
                }
            });
        }
    </script>
    
    <!-- Giữ các script cũ nếu cần (đảm bảo không bị mất chức năng) -->
    <script src="../../js/config/api-config.js"></script>
    <script src="../../js/config/constants.js"></script>
    <script src="../../js/utils/auth.js"></script>
    <script src="../../js/utils/date-format.js"></script>
    <script src="../../js/utils/file-upload.js"></script>
    <script src="../../js/components/modal.js"></script>
    <script src="../../js/components/notification.js"></script>
    <script src="../../js/services/course-service.js"></script>
    <script src="../../js/pages/class-detail.js" type="module"></script>
</body>
</html>